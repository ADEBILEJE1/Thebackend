<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kitchen Management Test - Batch Support</title>
    <style>
        body {
            font-family: Calibri, Arial, sans-serif;
            margin: 20px;
            background: white;
            font-size: 11pt;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .header {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
            background: #f8f8f8;
        }
        .section {
            border: 1px solid #ccc;
            margin-bottom: 10px;
        }
        .section-header {
            background: #e6e6e6;
            padding: 8px;
            font-weight: bold;
            border-bottom: 1px solid #ccc;
        }
        .section-content {
            padding: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 10pt;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 4px 8px;
            text-align: left;
        }
        th {
            background: #f0f0f0;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background: #f9f9f9;
        }
        input, select, button, textarea {
            font-family: inherit;
            font-size: 10pt;
            padding: 3px 6px;
            border: 1px solid #ccc;
        }
        button {
            background: white;
            cursor: pointer;
            margin: 2px;
        }
        button:hover {
            background: #f0f0f0;
        }
        .form-row {
            margin: 5px 0;
        }
        .form-row label {
            display: inline-block;
            width: 120px;
            font-weight: bold;
        }
        .form-row input, .form-row select {
            width: 200px;
        }
        .logs {
            height: 150px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 5px;
            background: #fcfcfc;
            font-family: Consolas, monospace;
            font-size: 9pt;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: white;
        }
        .status {
            padding: 2px 6px;
            border-radius: 2px;
            font-size: 9pt;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.warning { background: #fff3cd; color: #856404; }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
        }
        body {
            padding-bottom: 170px;
        }
        .token-display {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            font-family: Consolas, monospace;
            font-size: 9pt;
            word-break: break-all;
            margin: 5px 0;
        }
        .copy-btn {
            float: right;
            font-size: 8pt;
            padding: 1px 4px;
        }
        .batch-section {
            background: #f0f8ff;
            border: 2px solid #4169e1;
            margin: 5px 0;
            padding: 8px;
            border-radius: 4px;
        }
        .batch-header {
            font-weight: bold;
            color: #4169e1;
            margin-bottom: 5px;
        }
        .customer-info {
            background: #f9f9f9;
            border: 1px solid #ddd;
            padding: 8px;
            margin: 5px 0;
            border-radius: 3px;
        }
        .delivery-info {
            background: #fff8dc;
            border: 1px solid #ddd;
            padding: 8px;
            margin: 5px 0;
            border-radius: 3px;
        }
        .history-section {
            background: #f5f5f5;
            border: 1px solid #999;
            margin: 5px 0;
            padding: 8px;
            border-radius: 4px;
        }
        .history-header {
            font-weight: bold;
            color: #666;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h2>Kitchen Management System - Test Interface (Batch Support)</h2>
            <div class="form-row">
                <label>Base URL:</label>
                <input type="text" id="baseUrl" value="http://localhost:8000" placeholder="http://localhost:8000">
            </div>
            <div class="form-row">
                <label>Admin Email:</label>
                <input type="text" id="adminEmail" placeholder="admin@example.com">
            </div>
            <div class="form-row">
                <label>Password:</label>
                <input type="password" id="adminPassword" placeholder="admin password">
            </div>
            <button onclick="testConnection()">Test Connection</button>
            <button onclick="loginUser()">Login</button>
            <span id="authStatus" class="status"></span>
            
            <div id="tokenDisplay" style="display:none;">
                <div class="form-row">
                    <label>Access Token:</label>
                    <div class="token-display" id="accessToken">
                        <button class="copy-btn" onclick="copyToken()">Copy</button>
                        <div id="accessTokenValue"></div>
                    </div>
                </div>
                <div class="form-row">
                    <label>Manual Token:</label>
                    <input type="text" id="manualToken" placeholder="Paste token here to use manually" style="width:400px">
                    <button onclick="setManualToken()">Use Token</button>
                </div>
            </div>
        </div>

        <div class="grid">
            <div>
                <div class="section">
                    <div class="section-header">Batch Kitchen Queue (Active)</div>
                    <div class="section-content">
                        <button onclick="getKitchenBatchQueue()">Get Active Batches</button>
                        <button onclick="markBatchReady()">Mark Batch Ready</button>
                        <button onclick="getKitchenQueue()">Get Individual Orders</button>
                        
                        <div class="form-row">
                            <label>Batch ID:</label>
                            <input type="text" id="batchId" placeholder="BATCH-20250923-..." style="width:200px">
                        </div>
                        
                        <div id="batchQueueData"></div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header">Kitchen History</div>
                    <div class="section-content">
                        <button onclick="getKitchenHistory()">Get Kitchen History</button>
                        <button onclick="clearHistoryView()">Clear View</button>
                        
                        <div class="form-row">
                            <label>Limit:</label>
                            <input type="number" id="historyLimit" value="20" style="width:60px">
                        </div>
                        <div class="form-row">
                            <label>Offset:</label>
                            <input type="number" id="historyOffset" value="0" style="width:60px">
                        </div>
                        
                        <div id="historyData"></div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header">Traditional Kitchen Queue</div>
                    <div class="section-content">
                        <button onclick="getKitchenQueue()">Get Kitchen Queue</button>
                        <button onclick="markOrderReady()">Mark Order Ready</button>
                        <button onclick="printOrderReceipt()">Print Receipt</button>
                        
                        <div class="form-row">
                            <label>Order Number:</label>
                            <input type="text" id="orderNumber" placeholder="ORD-20250101-001" style="width:150px">
                        </div>
                        <div class="form-row">
                            <label>Order ID:</label>
                            <input type="text" id="orderId" placeholder="order-id" style="width:150px">
                        </div>
                        
                        <div id="kitchenData"></div>
                    </div>
                </div>
            </div>

            <div>
                <div class="section">
                    <div class="section-header">Order Management (Batch Orders Only)</div>
                    <div class="section-content">
                        <button onclick="getAllOrders()">Get All Batch Orders</button>
                        <button onclick="getOrderById()">Get Order by ID</button>
                        <button onclick="updateOrderStatus()">Update Status</button>
                        
                        <div class="form-row">
                            <label>Status Filter:</label>
                            <select id="statusFilter" style="width:120px">
                                <option value="">All</option>
                                <option value="preparing">Preparing</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <label>Order Type:</label>
                            <select id="orderTypeFilter" style="width:120px">
                                <option value="">All</option>
                                <option value="online">Online</option>
                                <option value="offline">Offline</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <label>New Status:</label>
                            <select id="newStatus" style="width:120px">
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                        
                        <div id="orderData"></div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header">Today's Statistics</div>
                    <div class="section-content">
                        <button onclick="getTodayStats()">Get Today's Stats</button>
                        
                        <div id="statsData"></div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header">Chef Analytics</div>
                    <div class="section-content">
                        <button onclick="getChefAnalytics()">Chef Analytics</button>
                        
                        <div class="form-row">
                            <label>Chef ID:</label>
                            <input type="text" id="chefId" placeholder="chef-id" style="width:150px">
                        </div>
                        <div class="form-row">
                            <label>Days:</label>
                            <input type="number" id="analyticsDays" value="30" style="width:60px">
                        </div>
                        
                        <div id="analyticsData"></div>
                    </div>
                </div>
            </div>

            <div>
                <div class="section">
                    <div class="section-header">Date Filters</div>
                    <div class="section-content">
                        <div class="form-row">
                            <label>Date From:</label>
                            <input type="date" id="dateFrom" style="width:150px">
                        </div>
                        <div class="form-row">
                            <label>Date To:</label>
                            <input type="date" id="dateTo" style="width:150px">
                        </div>
                        <button onclick="getOrdersWithFilters()">Apply Filters</button>
                        
                        <div id="filteredData"></div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header">Order Queue Management</div>
                    <div class="section-content">
                        <button onclick="refreshQueue()">Refresh Queue</button>
                        <button onclick="clearCompletedOrders()">Clear Completed</button>
                        
                        <div id="queueData"></div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header">Kitchen Performance</div>
                    <div class="section-content">
                        <button onclick="getKitchenPerformance()">Performance Report</button>
                        <button onclick="getPreparationTimes()">Prep Times</button>
                        
                        <div class="form-row">
                            <label>Report Days:</label>
                            <input type="number" id="reportDays" value="7" style="width:60px">
                        </div>
                        
                        <div id="performanceData"></div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header">System Information</div>
                    <div class="section-content">
                        <button onclick="getSystemInfo()">System Info</button>
                        <button onclick="checkApiHealth()">API Health</button>
                        
                        <div id="systemData"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="logs" id="logsContainer">
        <div style="padding: 5px; background: #eee; border-bottom: 1px solid #ccc;">
            <strong>Activity Logs</strong>
            <button onclick="clearLogs()" style="float: right;">Clear</button>
        </div>
        <div class="logs" id="logs" style="height: 120px; position: static;"></div>
    </div>

    <script>
        let authToken = '';
        let currentUser = null;
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('logs');
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
            logElement.textContent += logEntry;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('logs').textContent = '';
        }

        function getBaseUrl() {
            return document.getElementById('baseUrl').value.trim();
        }

        function updateStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
        }

        function renderTable(data, containerId) {
            if (!Array.isArray(data) || data.length === 0) {
                document.getElementById(containerId).innerHTML = '<p>No data available</p>';
                return;
            }

            const keys = Object.keys(data[0]);
            let html = '<table><thead><tr>';
            keys.forEach(key => html += `<th>${key}</th>`);
            html += '</tr></thead><tbody>';
            
            data.forEach(row => {
                html += '<tr>';
                keys.forEach(key => {
                    let value = row[key];
                    if (typeof value === 'object' && value !== null) {
                        value = JSON.stringify(value);
                    }
                    html += `<td>${value || ''}</td>`;
                });
                html += '</tr>';
            });
            html += '</tbody></table>';
            
            document.getElementById(containerId).innerHTML = html;
        }

        function renderBatchData(data, containerId) {
            if (!data || !data.batches || data.batches.length === 0) {
                document.getElementById(containerId).innerHTML = '<p>No batch data available</p>';
                return;
            }

            let html = '';
            data.batches.forEach(batch => {
                html += `<div class="batch-section">`;
                html += `<div class="batch-header">Batch ID: ${batch.batch_id}</div>`;
                
                // Customer Information
                if (batch.customer_info) {
                    html += `<div class="customer-info">`;
                    html += `<strong>Customer Information:</strong><br>`;
                    html += `Name: ${batch.customer_info.name || 'N/A'}<br>`;
                    html += `Phone: ${batch.customer_info.phone || 'N/A'}<br>`;
                    html += `Email: ${batch.customer_info.email || 'N/A'}`;
                    html += `</div>`;
                }
                
                // Delivery Information
                if (batch.delivery_info) {
                    html += `<div class="delivery-info">`;
                    html += `<strong>Delivery Information:</strong><br>`;
                    html += `Address: ${batch.delivery_info.full_address || 'N/A'}<br>`;
                    if (batch.delivery_info.delivery_areas) {
                        html += `Area: ${batch.delivery_info.delivery_areas.name || 'N/A'}<br>`;
                        html += `Est. Time: ${batch.delivery_info.delivery_areas.estimated_time || 'N/A'}`;
                    }
                    html += `</div>`;
                }
                
                html += `<p><strong>Total Items:</strong> ${batch.total_items}</p>`;
                html += `<p><strong>Orders Count:</strong> ${batch.orders.length}</p>`;
                html += `<p><strong>Preparing Since:</strong> ${new Date(batch.preparing_at).toLocaleString()}</p>`;
                
                html += `<h4>Orders in Batch:</h4>`;
                batch.orders.forEach(order => {
                    html += `<div style="margin-left: 20px; margin-bottom: 10px;">`;
                    html += `<p><strong>Order #:</strong> ${order.order_number || order.id}</p>`;
                    html += `<p><strong>Items:</strong></p>`;
                    html += `<ul>`;
                    order.order_items.forEach(item => {
                        html += `<li>${item.product_name} x${item.quantity}`;
                        if (item.notes) html += ` (${item.notes})`;
                        html += `</li>`;
                    });
                    html += `</ul>`;
                    html += `</div>`;
                });
                
                html += `</div>`;
            });
            
            document.getElementById(containerId).innerHTML = html;
        }

        function renderHistoryData(data, containerId) {
            if (!data || !data.history || data.history.length === 0) {
                document.getElementById(containerId).innerHTML = '<p>No history data available</p>';
                return;
            }

            let html = '';
            data.history.forEach(item => {
                html += `<div class="history-section">`;
                
                if (item.type === 'batch') {
                    html += `<div class="history-header">BATCH: ${item.batch_id}</div>`;
                    html += `<p><strong>Completed:</strong> ${new Date(item.completed_at).toLocaleString()}</p>`;
                    html += `<p><strong>Total Items:</strong> ${item.total_items}</p>`;
                    html += `<p><strong>Orders:</strong> ${item.orders.length}</p>`;
                    
                    if (item.customer_info) {
                        html += `<p><strong>Customer:</strong> ${item.customer_info.name || 'N/A'}</p>`;
                        html += `<p><strong>Phone:</strong> ${item.customer_info.phone || 'N/A'}</p>`;
                    }
                } else {
                    html += `<div class="history-header">INDIVIDUAL ORDER: ${item.order.order_number}</div>`;
                    html += `<p><strong>Completed:</strong> ${new Date(item.completed_at).toLocaleString()}</p>`;
                    html += `<p><strong>Customer:</strong> ${item.order.customer_name || 'N/A'}</p>`;
                    html += `<p><strong>Total:</strong> $${item.order.total}</p>`;
                }
                
                html += `</div>`;
            });
            
            document.getElementById(containerId).innerHTML = html;
        }

        function renderData(data, containerId) {
            if (typeof data === 'object' && !Array.isArray(data)) {
                document.getElementById(containerId).innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
            } else if (Array.isArray(data)) {
                renderTable(data, containerId);
            } else {
                document.getElementById(containerId).innerHTML = `<p>${data}</p>`;
            }
        }

        function copyToken() {
            const tokenElement = document.getElementById('accessTokenValue');
            const tokenText = tokenElement.textContent;
            
            navigator.clipboard.writeText(tokenText).then(() => {
                log(`Token copied to clipboard: ${tokenText.substring(0, 20)}...`, 'success');
            }).catch(err => {
                log(`Failed to copy token: ${err}`, 'error');
            });
        }

        function setManualToken() {
            const manualToken = document.getElementById('manualToken').value;
            if (manualToken) {
                authToken = manualToken;
                updateStatus('authStatus', 'Manual token set', 'success');
                log('Manual token applied', 'success');
            }
        }

        async function apiCall(endpoint, method = 'GET', body = null) {
            const url = `${getBaseUrl()}${endpoint}`;
            const headers = {
                'Content-Type': 'application/json'
            };

            if (authToken) {
                headers['Authorization'] = `Bearer ${authToken}`;
            }

            const config = {
                method,
                headers
            };

            if (body) {
                config.body = JSON.stringify(body);
            }

            try {
                log(`${method} ${url}`);
                const response = await fetch(url, config);
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${data.detail || 'Request failed'}`);
                }
                
                log(`Response: ${JSON.stringify(data).substring(0, 200)}...`, 'success');
                return data;
            } catch (error) {
                log(`Error: ${error.message}`, 'error');
                throw error;
            }
        }

        async function testConnection() {
            try {
                const response = await fetch(`${getBaseUrl()}/docs`);
                if (response.ok) {
                    updateStatus('authStatus', 'Connection OK', 'success');
                    log('Connection test successful', 'success');
                } else {
                    throw new Error('Connection failed');
                }
            } catch (error) {
                updateStatus('authStatus', 'Connection Failed', 'error');
                log(`Connection test failed: ${error.message}`, 'error');
            }
        }

        async function loginUser() {
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;
            
            if (!email || !password) {
                updateStatus('authStatus', 'Email and password required', 'error');
                return;
            }

            try {
                const data = await apiCall('/auth/login', 'POST', { email, password });
                authToken = data.access_token;
                currentUser = data.user;
                
                updateStatus('authStatus', `Logged in as ${data.user.role}`, 'success');
                log(`Login successful: ${data.user.email} (${data.user.role})`, 'success');
                
                document.getElementById('tokenDisplay').style.display = 'block';
                document.getElementById('accessTokenValue').textContent = data.access_token;
                
            } catch (error) {
                updateStatus('authStatus', 'Login Failed', 'error');
            }
        }

        // New Batch Kitchen Queue Functions
        async function getKitchenBatchQueue() {
            try {
                const data = await apiCall('/orders/queue/kitchen-batches');
                renderBatchData(data, 'batchQueueData');
                log(`Found ${data.batches ? data.batches.length : 0} batches in queue`, 'success');
            } catch (error) {
                document.getElementById('batchQueueData').innerHTML = '<p class="status error">Failed to load batch queue</p>';
            }
        }

        async function markBatchReady() {
            const batchId = document.getElementById('batchId').value;
            
            if (!batchId) {
                log('Batch ID is required', 'error');
                return;
            }
            
            try {
                const data = await apiCall(`/orders/chef/batch-ready?batch_id=${batchId}`, 'POST');
                renderData(data, 'batchQueueData');
                log(`Batch ${batchId} marked as ready`, 'success');
                // Refresh the queue to show updated state
                setTimeout(() => getKitchenBatchQueue(), 1000);
            } catch (error) {
                document.getElementById('batchQueueData').innerHTML = '<p class="status error">Failed to mark batch ready</p>';
            }
        }

        // Kitchen History
        async function getKitchenHistory() {
            const limit = document.getElementById('historyLimit').value || 20;
            const offset = document.getElementById('historyOffset').value || 0;
            
            try {
                const data = await apiCall(`/orders/queue/history?limit=${limit}&offset=${offset}`);
                renderHistoryData(data, 'historyData');
                log(`Loaded ${data.history ? data.history.length : 0} history items`, 'success');
            } catch (error) {
                document.getElementById('historyData').innerHTML = '<p class="status error">Failed to load kitchen history</p>';
            }
        }

        async function clearHistoryView() {
            document.getElementById('historyData').innerHTML = '<p class="status info">History view cleared</p>';
            log('History view cleared', 'info');
        }

        // Kitchen Queue (Traditional)
        async function getKitchenQueue() {
            try {
                const data = await apiCall('/orders/queue/kitchen');
                renderData(data, 'kitchenData');
            } catch (error) {
                document.getElementById('kitchenData').innerHTML = '<p class="status error">Failed to load kitchen queue</p>';
            }
        }

        async function markOrderReady() {
            const orderNumber = document.getElementById('orderNumber').value;
            
            if (!orderNumber) {
                log('Order number is required', 'error');
                return;
            }
            
            try {
                const data = await apiCall('/orders/chef/ready', 'POST', {
                    order_number: orderNumber
                });
                renderData(data, 'kitchenData');
                log(`Order ${orderNumber} marked as ready`, 'success');
            } catch (error) {
                document.getElementById('kitchenData').innerHTML = '<p class="status error">Failed to mark order ready</p>';
            }
        }

        async function printOrderReceipt() {
            const orderId = document.getElementById('orderId').value;
            
            if (!orderId) {
                log('Order ID is required', 'error');
                return;
            }
            
            try {
                const data = await apiCall(`/orders/${orderId}/print`);
                renderData(data, 'kitchenData');
                log(`Receipt generated for order ${orderId}`, 'success');
            } catch (error) {
                document.getElementById('kitchenData').innerHTML = '<p class="status error">Failed to generate receipt</p>';
            }
        }

        // Order Management (Updated to only show batch orders)
        async function getAllOrders() {
            try {
                const data = await apiCall('/orders/');
                renderTable(data, 'orderData');
                log(`Loaded ${data.length} batch orders`, 'success');
            } catch (error) {
                document.getElementById('orderData').innerHTML = '<p class="status error">Failed to load orders</p>';
            }
        }

        async function getOrderById() {
            const orderId = document.getElementById('orderId').value;
            
            if (!orderId) {
                log('Order ID is required', 'error');
                return;
            }
            
            try {
                const data = await apiCall(`/orders/${orderId}`);
                renderData(data, 'orderData');
            } catch (error) {
                document.getElementById('orderData').innerHTML = '<p class="status error">Failed to load order</p>';
            }
        }

        async function updateOrderStatus() {
            const orderId = document.getElementById('orderId').value;
            const newStatus = document.getElementById('newStatus').value;
            
            if (!orderId || !newStatus) {
                log('Order ID and new status are required', 'error');
                return;
            }
            
            try {
                const data = await apiCall(`/orders/${orderId}/status`, 'PATCH', {
                    status: newStatus
                });
                renderData(data, 'orderData');
                log(`Order ${orderId} status updated to ${newStatus}`, 'success');
            } catch (error) {
                document.getElementById('orderData').innerHTML = '<p class="status error">Failed to update order status</p>';
            }
        }

        async function getOrdersWithFilters() {
            const status = document.getElementById('statusFilter').value;
            const orderType = document.getElementById('orderTypeFilter').value;
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;
            
            let endpoint = '/orders/?';
            const params = [];
            
            if (status) params.push(`status=${status}`);
            if (orderType) params.push(`order_type=${orderType}`);
            if (dateFrom) params.push(`date_from=${dateFrom}`);
            if (dateTo) params.push(`date_to=${dateTo}`);
            
            endpoint += params.join('&');
            
            try {
                const data = await apiCall(endpoint);
                renderTable(data, 'filteredData');
            } catch (error) {
                document.getElementById('filteredData').innerHTML = '<p class="status error">Failed to load filtered orders</p>';
            }
        }

        // Statistics
        async function getTodayStats() {
            try {
                const data = await apiCall('/orders/stats/today');
                renderData(data, 'statsData');
            } catch (error) {
                document.getElementById('statsData').innerHTML = '<p class="status error">Failed to load today stats</p>';
            }
        }

        // Analytics
        async function getChefAnalytics() {
            const chefId = document.getElementById('chefId').value;
            const days = document.getElementById('analyticsDays').value || 30;
            
            if (!chefId) {
                log('Chef ID is required', 'error');
                return;
            }
            
            try {
                const data = await apiCall(`/orders/analytics/chef/${chefId}?days=${days}`);
                renderData(data, 'analyticsData');
            } catch (error) {
                document.getElementById('analyticsData').innerHTML = '<p class="status error">Failed to load chef analytics</p>';
            }
        }

        // Queue Management
        async function refreshQueue() {
            await getKitchenBatchQueue();
            await getKitchenQueue();
            log('Kitchen queues refreshed', 'success');
        }

        async function clearCompletedOrders() {
            log('Clear completed orders - this would filter out completed orders from display', 'info');
            document.getElementById('queueData').innerHTML = '<p class="status success">Completed orders cleared from view</p>';
        }

        // Performance
        async function getKitchenPerformance() {
            const days = document.getElementById('reportDays').value || 7;
            
            log(`Kitchen performance report for last ${days} days`, 'info');
            document.getElementById('performanceData').innerHTML = `
                <p class="status info">Performance report for ${days} days</p>
                <p>Use Chef Analytics for detailed performance data</p>
            `;
        }

        async function getPreparationTimes() {
            log('Preparation times analysis', 'info');
            document.getElementById('performanceData').innerHTML = `
                <p class="status info">Preparation times analysis</p>
                <p>Available in Chef Analytics section</p>
            `;
        }

        // System
        async function getSystemInfo() {
            try {
                const data = await apiCall('/orders/stats/today');
                document.getElementById('systemData').innerHTML = `
                    <p class="status success">API is responding</p>
                    <p>Kitchen endpoints: Available</p>
                    <p>Batch endpoints: Available</p>
                    <p>History endpoints: Available</p>
                    <p>Last response time: ${new Date().toLocaleTimeString()}</p>
                `;
            } catch (error) {
                document.getElementById('systemData').innerHTML = '<p class="status error">System check failed</p>';
            }
        }

        async function checkApiHealth() {
            try {
                await apiCall('/orders/queue/kitchen-batches');
                await apiCall('/orders/queue/kitchen');
                await apiCall('/orders/queue/history?limit=1');
                document.getElementById('systemData').innerHTML = '<p class="status success">API Health: OK (Batch, Individual & History)</p>';
                log('API health check passed (including batch and history endpoints)', 'success');
            } catch (error) {
                document.getElementById('systemData').innerHTML = '<p class="status error">API Health: FAILED</p>';
                log('API health check failed', 'error');
            }
        }

        // Auto-set today's date for filters
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            const sevenDaysAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
            
            document.getElementById('dateTo').value = today;
            document.getElementById('dateFrom').value = sevenDaysAgo;
        });

        // Initialize
        log('Kitchen Management Test Interface with Batch Support and History loaded', 'success');
    </script>
</body>
</html>